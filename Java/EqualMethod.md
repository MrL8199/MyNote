---
title: Java - Equal method
date: 2021-06-20 18:00:26
updated: 2021-06-20 18:00:26
tags:
    - java
    - equal
    - hashcode
    - EqualsVerifier
category: 
    - java
---

## S02

```java
    public class Point {
        private int x;
        private int y;

        public Point(int x, int y) {
            this.x = x;
            this.y = y;
        }

        public boolean equals(Point obj) {
            if (!(obj instanceof Point)) {
                return false;
            }
            return x == obj.x && y == obj.y;
        }

        public int hashCode() {
            int result = x;
            result = 31 * result + y;
            return result;
        }
    }

    @Test
    public void whats_the_problem() {
        Point point = new Point(1, 1);
        Point clone = new Point(1, 1);
        List<Point> pts  = List.of(point);
        Assert.assertTrue(point.equals(clone));  // TRUE
        Assert.assertTrue(pts.contains(clone));     // FALSE
    }
```

- Solution: `public boolean equals(Point obj)` -> `public boolean equals(Object obj)`

## S03

```java
    public boolean equals(Object obj) {
            if (!(obj instanceof Point)) {
                return false;
            }
            Point other = (Point) obj;
            return x == other.x && y == other.y;
        }
```

```java
    @Test
    public void whats_the_problem() {
        Point point = new Point(1, 1);
        Set<Point> pts = new HashSet<>();
        pts.add(point);
        point.x = 3;
        Assert.assertTrue(pts.contains(point));  // FALSE
    }
```    

- How to pass `EqualVerifier`?

```java
 EqualsVerifier.forClass(Point.class)
            .suppress(Warning.NONFINAL_FIELDS)
            .verify();
```

## S04

- `equals` and `hashCode` method has be generated by IDE, without
  tick `Accept subclasses as parameter to equal() method`

```java
    public class Point {
        private final int x;
        private final int y;

        public Point(int x, int y) {
            this.x = x;
            this.y = y;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (o == null || getClass() != o.getClass()) return false;
            Point point = (Point) o;
            return x == point.x && y == point.y;
        }

        @Override
        public int hashCode() {
            return Objects.hash(x, y);
        }
    }

    @Test
    public void whats_the_problem() {
        Point point = new Point(1, 1);
        Point sub = new Point(1, 1) {   };
        Assert.assertEquals(point, sub);  // FALSE
    }
```

- How to pass `EqualVerifier`?

```java
 EqualsVerifier.forClass(Point.class)
            .usingGetClass()
            .verify();
```

### S05

- `equals` and `hashCode` method has be generated by IDE, with tick `Accept subclasses as parameter to equal() method`

```java
    public class Point {
        private final int x;
        private final int y;

        public Point(int x, int y) {
            this.x = x;
            this.y = y;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (!(o instanceof Point)) return false;
            Point point = (Point) o;
            return x == point.x && y == point.y;
        }

        @Override
        public int hashCode() {
            return Objects.hash(x, y);
        }
    }
    
    @Test
    public void solves_liskov_substitution_principle() {
        Point point = new Point(1, 1);
        Point sub = new Point(1, 1) {   };
        Assert.assertEquals(point, sub);  // TRUE
    }
```

```java
    public class ColorPoint extends Point {

        private final Color color;

        public ColorPoint(int x, int y, Color color) {
            super(x, y);
            this.color = color;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (!(o instanceof ColorPoint)) return false;
            if (!super.equals(o)) return false;
            ColorPoint that = (ColorPoint) o;
            return color.equals(that.color);
        }

        @Override
        public int hashCode() {
            return Objects.hash(super.hashCode(), color);
        }
    }

    @Test
    public void whats_the_problem(){
        Point p = new Point(1,1);
        Point q = new ColorPoint(1,1, Color.BLACK);
        Assert.assertEquals(p,q); // TRUE
        Assert.assertEquals(q,p); // FALSE
    }
    
```

- Solution? -> S06

### S06

- Modified `equal` method of ColorPoint

```java
    public class ColorPoint extends Point {

        private final Color color;

        public ColorPoint(int x, int y, Color color) {
            super(x, y);
            this.color = color;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (o instanceof ColorPoint) {
                ColorPoint that = (ColorPoint) o;
                return super.equals(that) && color == that.color;
            }
            if (o instanceof Point) {
                return o.equals(this);
            }
            return false;
        }

        @Override
        public int hashCode() {
            return Objects.hash(super.hashCode(), color);
        }
    }

    @Test
    public void whats_the_problem() {
        Point p = new Point(1, 1);
        Point q = new ColorPoint(1, 1, Color.BLACK);
        Assert.assertEquals(p, q); // TRUE
        Assert.assertEquals(q, p); // TRUE
    }
```

### S08

- `final` before `equal` & `hashCode` method

```java
    public class Point {
        private final int x;
        private final int y;

        public Point(int x, int y) {
            this.x = x;
            this.y = y;
        }

        @Override
        public final boolean equals(Object o) {
            if (this == o) return true;
            if (!(o instanceof Point)) return false;
            Point point = (Point) o;
            return x == point.x && y == point.y;
        }

        @Override
        public final int hashCode() {
            return Objects.hash(x, y);
        }
    }

    @Test
    public void whats_the_problem() {
        EqualsVerifier.forClass(Point.class).verify(); // TRUE
    }
```

Ref: [Youtube](https://youtu.be/pNJ_O10XaoM)